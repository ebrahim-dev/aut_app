<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
  </head>
  <body>
    <h1>Welcome to the Dashboard</h1>
    <p>Email: <span id="userEmail"></span></p>
    <p>Generated Code: <span id="generatedCode"></span></p>
    <div><span id="liveTimerValue"></span></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const userEmailElement = document.getElementById("userEmail");
        const generatedCodeElement = document.getElementById("generatedCode");

        // Haal de opgeslagen gebruikersgegevens op uit localStorage
        const userEmail = localStorage.getItem("userEmail");
        const generatedCode = localStorage.getItem("generatedCode");

        // Toon de gegevens op de pagina
        userEmailElement.textContent = userEmail;
        generatedCodeElement.textContent = generatedCode;
      });
      document.addEventListener("DOMContentLoaded", function () {
        const liveTimerElement = document.getElementById("liveTimerValue");

        function updateLiveTimerValue() {
          const storedValue = localStorage.getItem("liveTimerValue");
          if (storedValue !== null) {
            liveTimerElement.textContent = storedValue;
          }
        }

        // Roep de functie aan om de waarde bij het laden van de pagina op te halen
        updateLiveTimerValue();

        // Optioneel: Update de waarde op de inlogpagina wanneer deze verandert in de auth-app pagina
        window.addEventListener("storage", function (e) {
          if (e.key === "liveTimerValue") {
            liveTimerElement.textContent = e.newValue;
          }
        });
      });
      function checkGeneratedCode() {
        const userEmail = localStorage.getItem("userEmail");

        if (userEmail) {
          // Stuur een verzoek naar de server om de gegenereerde code op te halen
          fetch(`http://localhost:4000/getGeneratedCode?email=${userEmail}`)
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                const generatedCodeElement =
                  document.getElementById("generatedCode");
                generatedCodeElement.textContent = data.generatedCode;
              } else {
                console.error(
                  "Fout bij het ophalen van gegenereerde code:",
                  data.message
                );
              }
            })
            .catch((error) => {
              console.error(
                "Fout bij het verzenden van gegevens naar de server:",
                error
              );
            });
        }
      }

      // Roep de functie elke 2 seconden aan
      setInterval(checkGeneratedCode, 2000);
    </script>
  </body>
</html>
